<!-- Copyright (c) 2025, Pablo Diz de la Cruz -->
<!-- All rights reserved. -->
<!-- Licensed under the BSD 3-Clause License. See LICENSE file in the project root for full license information. -->

{% extends 'base.html' %}
{% block header %}{% endblock %}
{% block content %}

{% load static %}
{% include 'styles.html' %}

<div class="email-event-container" style="max-width:600px; margin:0 auto; width:100%; box-sizing:border-box; padding:12px;">
    <div style="margin:18px auto; padding:14px; border-radius:10px; background-color:#f0fbfa; width:100%; max-width:560px; box-sizing:border-box; min-height:220px;">
        {% include 'mywifipass/email/email_event_details.html' %}
    </div>

    <div style="margin:12px auto; background: #ffffff; border: 2px solid #9ACBD0; border-radius:10px; padding:14px; width:100%; max-width:560px; box-sizing:border-box;">
        <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="width:100%; height:130px;"><tr>
            <td valign="middle" style="text-align:center; height:130px;">
                <h3 style="margin:0 0 8px 0; color: #006A71; text-align:center;">🎫 Tu pase Wi-Fi está listo</h3>
                <p style="margin:0 60px 12px 60px; color: #333;">Con tu Pase Wi-Fi, podrás acceder a la red del evento de forma rápida y segura.</p>
                <p style="text-align:center; margin-top: 12px; margin-left: 60px; margin-right: 60px; padding: 8px 12px; background-color:#f6f7f8b4; font-style:italic; font-size: 12px; display: inline-block; border-radius: 6px;">Por seguridad, solo podrás instalar cada pase Wi-Fi en un dispositivo.</p>
            </td>
        </tr></table>
    </div>

    <div class="steps" style="margin:18px auto; padding:14px; border-radius:10px; background-color:#f0fbfa; width:100%; max-width:560px; box-sizing:border-box">
        <h3 style="margin:0 0 8px 0; color: #006A71; text-align:center;">📋 Pasos para conectarte:</h3>
        <ol style="margin:8px 0 0 18px; padding:0; color:#333;">
            <li>Instala la aplicación <a href="{{ playstore_url }}" style="display:inline-block; font-weight:bold;">MyWifiPass</a> en tu móvil</li>
            <li>Abre la app y escanea el código QR o pulsa el enlace para descargar tu pase Wi-Fi</li>
            {% if location.requires_validator %}
            <li>Al llegar al evento, muestra tu pase Wi-Fi a un validador</li>
            {% endif %}
            <li>Conéctate automáticamente a la red Wi‑Fi del evento</li>
        </ol>
    </div>

    <div class="qr-section" style="margin:18px auto; background: #ffffff; border: 2px solid #9ACBD0; border-radius:10px; padding:14px; width:100%; max-width:560px; box-sizing:border-box; min-height:220px;">
        <h3 style="margin:0 0 8px 0; color: #006A71;">Descarga tu pase Wi-Fi</h3>

        <div style="text-align:center; margin-bottom:30px;margin-top:30px;">
            <a href="{{ pass_url }}" style="display:inline-block; background:#006A71; color:#ffffff; padding:10px 18px; border-radius:20px; font-weight:bold; text-decoration:none; word-break:break-all;" target="_blank" aria-label="Abre el pase Wi-Fi en la app">Abre el pase Wi-Fi en la app</a>
        </div>

        <div class="qr-code" style="text-align:center;">
            <img src="{{ qr_code_url }}" alt="QR Code para MyWifiPass" 
                 style="max-width: 200px; width: 200px; height: 200px; display: block; margin: 0 auto; border: 2px solid #9ACBD0; border-radius: 8px; padding: 10px; background: white;"
                 onload="this.style.border='2px solid #28a745'; document.getElementById('qr-success').style.display='block';"
                 onerror="this.style.display='none'; document.getElementById('qr-fallback').style.display='block';">
                <div id="qr-fallback" style="display:none;">
                <img src="{{ qr_code_base64 }}" alt="QR Code para MyWifiPass (Respaldo)" 
                     style="max-width: 200px; width: 200px; height: 200px; display: block; margin: 0 auto; border: 2px solid #ffc107; border-radius: 8px; padding: 10px; background: white;"
                     onload="this.style.border='2px solid #28a745'; document.getElementById('qr-base64-success').style.display='block';"
                     onerror="document.getElementById('qr-final-fallback').style.display='block'; this.parentNode.style.display='none';">

            </div>
            <div id="qr-final-fallback" style="display: none; padding: 20px; background: #fff3cd; border: 2px dashed #ffc107; border-radius: 8px; text-align: center;">
                <p><strong>📱 Código QR no disponible</strong></p>
                <p>El QR está disponible como adjunto en este email</p>
            </div>
        </div>

        <p style="text-align:center; margin-top:12px;"><strong>O escanea este código QR con la app</strong></p>
        <p style="text-align:center; margin-top: 12px; margin-left: 30px; margin-right: 30px; padding: 8px 12px; background-color:#f6f7f8b4; font-style:italic; font-size: 12px; display: inline-block; border-radius: 6px;">Es posible que el código QR no se muestre correctamente en algunos clientes web de correo electrónico. Si es así, presiona sobre el recuadro para verlo.</p>
    </div>

    <div class="install-section" style="margin:18px auto; padding:12px; border-radius:10px; background-color:#f0fbfa; width:100%; max-width:560px; box-sizing:border-box; color:#006A71; text-align:center;">
        <h3 style="margin:0 0 8px 0; text-transform: none; color:#006A71;">📱 ¿Aún no tienes la aplicación MyWifiPass?</h3>
        <p style="margin:0 60px 12px 60px; color:#333;">Descárgala para poder conectarte al evento y gestionar tu pase desde el móvil.</p>
        <a href="{{ playstore_url }}" target="_blank">
            <img src="https://play.google.com/intl/en_us/badges/static/images/badges/es_badge_web_generic.png" 
            alt="Disponible en Google Play" 
            width="200" />
        </a>
    </div>
</div>

{% endblock %}